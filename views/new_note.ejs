<%- include("partials/header"); -%>

    <nav class="navbar navbar-expand-lg navbar-light bg-transparent">
        <ul class="navbar-nav">
            <li class="nav-item">
                <button id="start-record-btn" class="btn btn-primary custom" title="Start Recording">Begin Recognition</button>
            </li>

            <li class="nav-item">
                <button id="pause-record-btn" class="btn btn-primary custom" title="Pause Recording">End Recording</button>
            </li>

            <li class="nav-item">
                <label class="btn btn-primary btn-file">
                        Add Illustration <input type="file" style="display: none;">
                    </label>
            </li>

            <li class="nav-item">
                <form class="" method="POST" action="/submit">
                    <input name="noteTitle" id="noteTitle" type="text" placeholder="Enter Title" class="bg-transparent">
                    <textarea name="noteBody" id="noteBody" style="display: none;"> </textarea>
                    <input id="submitNote" class="border-0 text-white btn bg-dark btn-file" type="submit" value="Save">
                </form>
            </li>
        </ul>
    </nav>

    <!-- Text Editor -->
    <div class="text-editor">
        <div id="editor"></div>

        <div class="card-grid">
            <div class="card">
                <img class="card-img-top" src="/images/test.jpg" alt="Card image cap">
            </div>
        </div>

    </div>

    <!-- Include the Quill library -->
    <script src="https://cdn.quilljs.com/1.0.0/quill.js"></script>

    <!-- Initialize Quill Text Editor -->
    <script>
        const toolbarOptions = [

            [{
                'font': []
            }],

            [{
                'size': ['small', false, 'large', 'huge']
            }], // custom dropdown

            ['bold', 'italic', 'underline', 'strike'], // toggled buttons

            [{
                'color': []
            }, {
                'background': []
            }], // dropdown with defaults from theme

            [{
                'script': 'sub'
            }, {
                'script': 'super'
            }], // superscript/subscript

            [{
                'header': 1
            }, {
                'header': 2
            }], // custom button values

            ['blockquote', 'code-block'],

            [{
                'list': 'ordered'
            }, {
                'list': 'bullet'
            }],
            [{
                'indent': '-1'
            }, {
                'indent': '+1'
            }], // outdent/indent
            [{
                'direction': 'rtl'
            }], // text direction

            [{
                'align': []
            }],

            ['clean'] // remove formatting button
        ];

        const editor = new Quill('#editor', {
            modules: {
                toolbar: toolbarOptions
            },
            placeholder: 'Start brainstorming....',
            theme: 'snow'
        });

        // Tracking Changes
        // editor.on('text-change', async function(delta, oldDelta, source) {
        //    let text = editor.getText();
        //    updateText(1, text);
        //});

        // Note Submission
        document.getElementById("submitNote").addEventListener('click', function() {
            const text = editor.root.innerHTML;
            let body = document.getElementById('noteBody');
            body.value = text;
        });

        // Recording Audio
        var onFail = function(e) {
            console.log('Rejected!', e);
        };

        var onSuccess = function(s) {
            var context = new webkitAudioContext();
            var mediaStreamSource = context.createMediaStreamSource(s);
            recorder = new Recorder(mediaStreamSource);
            recorder.record();

            // audio loopback
            // mediaStreamSource.connect(context.destination);
        }

        window.URL = window.URL || window.webkitURL;
        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;

        var recorder;
        var audio = document.querySelector('audio');

        document.getElementById("start-record-btn").addEventListener('click', function() {
            if (navigator.getUserMedia) {
                navigator.getUserMedia({
                    audio: true
                }, onSuccess, onFail);
            } else {
                console.log('navigator.getUserMedia not present');
            }
        });

        document.getElementById("start-record-btn").addEventListener('click', function() {
            recorder.stop();
            recorder.exportWAV(function(s) {
                audio.src = window.URL.createObjectURL(s);
            });
        });
    </script>



    <%- include("partials/footer"); -%>